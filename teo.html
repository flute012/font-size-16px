<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JSON 音檔測試</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .audio-block { margin-bottom: 1.5rem; }
    .loading { color: gray; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>🎧 JSON 音檔載入測試</h2>
  <div id="audioContainer"></div>

  <script>
    const lessonId = "L1";

    fetch('buttons.json')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('audioContainer');
        const filtered = data.filter(item => item.lesson === lessonId && item.type === 'audio');

        if (filtered.length === 0) {
          container.innerHTML = "<p>⚠️ 沒有音檔資料</p>";
          return;
        }

        filtered.forEach((item, index) => {
          const block = document.createElement('div');
          block.className = 'audio-block';

          const label = document.createElement('p');
          label.textContent = item.label;

          const status = document.createElement('p');
          status.textContent = '音檔載入中...';
          status.className = 'loading';

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.style.display = 'none';
          audio.preload = 'auto';

          const source = document.createElement('source');
          source.src = item.src;
          source.type = 'audio/mpeg';
          audio.appendChild(source);

          // 載入成功
          audio.addEventListener('canplaythrough', () => {
            status.remove();
            audio.style.display = 'block';
          });

          // 載入錯誤
          audio.addEventListener('error', () => {
            status.textContent = '❌ 無法載入音檔';
            status.className = 'error';
          });

          block.appendChild(label);
          block.appendChild(status);
          block.appendChild(audio);
          container.appendChild(block);
        });
      })
      .catch(err => {
        document.getElementById('audioContainer').innerHTML = `<p class="error">讀取 JSON 發生錯誤：${err}</p>`;
      });
  </script>
</body>
</html>
