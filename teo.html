<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>JSON & CSV éŸ³æª”æ¸¬è©¦</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    h2 { margin-top: 2rem; border-bottom: 1px solid #ccc; padding-bottom: 0.2rem; }
    .audio-block { margin-bottom: 1.5rem; }
    .loading { color: gray; }
    .error { color: red; }
    audio { display: block; margin-top: 0.3rem; }
  </style>
</head>
<body>
  <h1>ğŸ§ JSON èˆ‡ CSV éŸ³æª”è¼‰å…¥æ¸¬è©¦</h1>

  <div id="json-audio">
    <h2>ğŸ”¹ JSON æ¸¬è©¦å€</h2>
    <div id="jsonContainer"></div>
  </div>

  <div id="csv-audio">
    <h2>ğŸ”¸ CSV æ¸¬è©¦å€</h2>
    <div id="csvContainer"></div>
  </div>

<script>
const lessonId = 'L1';

function createAudioBlock(item) {
  const block = document.createElement('div');
  block.className = 'audio-block';

  const label = document.createElement('p');
  label.textContent = item.label;

  const status = document.createElement('p');
  status.textContent = 'éŸ³æª”è¼‰å…¥ä¸­...';
  status.className = 'loading';

  const audio = document.createElement('audio');
  audio.controls = true;
  audio.style.display = 'none';
  audio.preload = 'auto';

  const source = document.createElement('source');
  source.src = item.src || item.src_or_url || '';
  source.type = 'audio/mpeg';
  audio.appendChild(source);

  // äº‹ä»¶è™•ç†
  audio.addEventListener('canplaythrough', () => {
    status.remove();
    audio.style.display = 'block';
  });
  audio.addEventListener('error', () => {
    status.textContent = 'âŒ ç„¡æ³•è¼‰å…¥éŸ³æª”';
    status.className = 'error';
  });

  block.appendChild(label);
  block.appendChild(status);
  block.appendChild(audio);
  return block;
}

// âœ… JSON éŸ³æª”è¼‰å…¥
fetch('buttons.json')
  .then(res => res.json())
  .then(data => {
    const filtered = data.filter(item => item.lesson === lessonId && item.type === 'audio');
    const container = document.getElementById('jsonContainer');

    if (filtered.length === 0) {
      container.innerHTML = "<p>âš ï¸ æ²’æœ‰ JSON éŸ³æª”è³‡æ–™</p>";
    } else {
      filtered.forEach(item => {
        const block = createAudioBlock(item);
        container.appendChild(block);
      });
    }
  })
  .catch(err => {
    document.getElementById('jsonContainer').innerHTML = `<p class="error">è®€å– JSON ç™¼ç”ŸéŒ¯èª¤ï¼š${err}</p>`;
  });

// âœ… CSV éŸ³æª”è¼‰å…¥
Papa.parse('buttons.csv', {
  download: true,
  header: true,
  complete: function (results) {
    const data = results.data;
    const filtered = data.filter(item => item.lesson === lessonId && item.type === 'audio');
    const container = document.getElementById('csvContainer');

    if (filtered.length === 0) {
      container.innerHTML = "<p>âš ï¸ æ²’æœ‰ CSV éŸ³æª”è³‡æ–™</p>";
    } else {
      filtered.forEach(item => {
        const block = createAudioBlock(item);
        container.appendChild(block);
      });
    }
  },
  error: function (err) {
    document.getElementById('csvContainer').innerHTML = `<p class="error">è®€å– CSV ç™¼ç”ŸéŒ¯èª¤ï¼š${err}</p>`;
  }
});
</script>
</body>
</html>
