<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JSON éŸ³æª”æ¸¬è©¦</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .audio-block { margin-bottom: 1.5rem; }
    .loading { color: gray; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>ğŸ§ JSON éŸ³æª”è¼‰å…¥æ¸¬è©¦</h2>
  <div id="audioContainer"></div>

  <script>
    const lessonId = "L1";

    fetch('buttons.json')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('audioContainer');
        const filtered = data.filter(item => item.lesson === lessonId && item.type === 'audio');

        if (filtered.length === 0) {
          container.innerHTML = "<p>âš ï¸ æ²’æœ‰éŸ³æª”è³‡æ–™</p>";
          return;
        }

        filtered.forEach((item, index) => {
          const block = document.createElement('div');
          block.className = 'audio-block';

          const label = document.createElement('p');
          label.textContent = item.label;

          const status = document.createElement('p');
          status.textContent = 'éŸ³æª”è¼‰å…¥ä¸­...';
          status.className = 'loading';

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.style.display = 'none';
          audio.preload = 'auto';

          const source = document.createElement('source');
          source.src = item.src;
          source.type = 'audio/mpeg';
          audio.appendChild(source);

          // è¼‰å…¥æˆåŠŸ
          audio.addEventListener('canplaythrough', () => {
            status.remove();
            audio.style.display = 'block';
          });

          // è¼‰å…¥éŒ¯èª¤
          audio.addEventListener('error', () => {
            status.textContent = 'âŒ ç„¡æ³•è¼‰å…¥éŸ³æª”';
            status.className = 'error';
          });

          block.appendChild(label);
          block.appendChild(status);
          block.appendChild(audio);
          container.appendChild(block);
        });
      })
      .catch(err => {
        document.getElementById('audioContainer').innerHTML = `<p class="error">è®€å– JSON ç™¼ç”ŸéŒ¯èª¤ï¼š${err}</p>`;
      });
  </script>
</body>
</html>
